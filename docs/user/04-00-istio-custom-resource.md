# Istio Custom Resource

The `istios.operator.kyma-project.io` CustomResourceDefinition (CRD) describes the kind and the format of data that Istio Controller uses to configure, update, and manage the Istio installation. Applying the CR triggers the installation of Istio, and deleting it triggers the uninstallation of Istio. The default Istio CR has the name `default`.

To get the up-to-date CRD in the `yaml` format, run the following command:

```shell
kubectl get crd istios.operator.kyma-project.io -o yaml
```

You are only allowed to use one Istio CR, which you must create in the `kyma-system` namespace. If the namespace contains multiple Istio CRs, the oldest one reconciles the module. Any additional Istio CR is placed in the `Warning` state.

## Specification

This table lists all the possible parameters of the given resource together with their descriptions:

### Spec

| Parameter                                             | Type           | Description                                                                                                                                                                                                                                                                                                                                 |
|-------------------------------------------------------|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **components.cni**                                    | object         | Defines component configuration for Istio CNI DaemonSet.                                                                                                                                                                                                                                                                                    |
| **components.cni.k8s.affinity**                       | object         | Affinity is a group of affinity scheduling rules. To learn more, read about affininty in the [Istio documentation](https://istio.io/latest/docs/reference/config/istio.operator.v1alpha1/#Affinity).                                                                                                                                        |
| **components.cni.k8s.resources**                      | object         | Defines [Kubernetes resources requests and limits configuration](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/). For more information, read about Resources in the [Istio documentation](https://istio.io/latest/docs/reference/config/istio.operator.v1alpha1/#Resources ).                               |
| **components.ingressGateway**                         | object         | Defines component configurations for Istio Ingress Gateway.                                                                                                                                                                                                                                                                                 |
| **components.ingressGateway.k8s.hpaSpec**             | object         | Defines configuration for HorizontalPodAutoscaler.                                                                                                                                                                                                                                                                                          |
| **components.ingressGateway.k8s.hpaSpec.maxReplicas** | integer        | Specifies the upper limit for the number of Pods that can be set by the autoscaler. It cannot be smaller than **MinReplicas**.                                                                                                                                                                                                              |
| **components.ingressGateway.k8s.hpaSpec.minReplicas** | integer        | Specifies the lower limit for the number of replicas to which the autoscaler can scale down. By default, it is set to 1 Pod. The value can be set to 0 if the alpha feature gate `HPAScaleToZero` is enabled and at least one Object or External metric is configured. Scaling is active as long as at least one metric value is available. |
| **components.ingressGateway.k8s.resources**           | object         | Defines [Kubernetes resources requests and limits configuration](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/). To learn more, read the [Istio documentation](https://istio.io/latest/docs/reference/config/istio.operator.v1alpha1/#Resources).                                                          |
| **components.ingressGateway.k8s.strategy**            | object         | Defines the rolling update strategy. To learn more, read about DeploymentStrategy in the [Istio documentation](https://istio.io/latest/docs/reference/config/istio.operator.v1alpha1/#DeploymentStrategy).                                                                                                                                  |
| **components.pilot**                                  | object         | Defines component configuration for Istiod.                                                                                                                                                                                                                                                                                                 |
| **components.pilot.k8s.hpaSpec**                      | object         | Defines configuration for HorizontalPodAutoscaler.                                                                                                                                                                                                                                                                                          |
| **components.pilot.k8s.hpaSpec.maxReplicas**          | integer        | Specifies the upper limit for the number of Pods that can be set by the autoscaler. It cannot be smaller than **MinReplicas**.                                                                                                                                                                                                              |
| **components.pilot.k8s.hpaSpec.minReplicas**          | integer        | Specifies the lower limit for the number of replicas to which the autoscaler can scale down. By default, it is set to 1 Pod. The value can be set to 0 if the alpha feature gate `HPAScaleToZero` is enabled and at least one Object or External metric is configured. Scaling is active as long as at least one metric value is available. |
| **components.pilot.k8s.resources**                    | object         | Defines [Kubernetes resources requests and limits configuration](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/). For more information, read about Resources in the [Istio documentation](https://istio.io/latest/docs/reference/config/istio.operator.v1alpha1/#Resources).                                |
| **components.pilot.k8s.strategy**                     | object         | Defines the rolling update strategy. To learn more, read about DeploymentStrategy in the [Istio documentation](https://istio.io/latest/docs/reference/config/istio.operator.v1alpha1/#DeploymentStrategy).                                                                                                                                  |
| **components.proxy**                                  | object         | Defines component configuration for the Istio proxy sidecar.                                                                                                                                                                                                                                                                                |
| **components.proxy.k8s.resources**                    | object         | Defines [Kubernetes resources requests and limits configuration](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/). To learn more, read about Resources in the [Istio documnetation](https://istio.io/latest/docs/reference/config/istio.operator.v1alpha1/#Resources).                                       |
| **config**                                            | object         | Specifies the configuration for the Istio installation.                                                                                                                                                                                                                                                                                     |
| **config.authorizers**                                | \[\]authorizer | Specifies the list of external authorizers that will be configured in Istio mesh config.                                                                                                                                                                                                                                                    |
| **config.numTrustedProxies**                          | integer        | Specifies the number of trusted proxies deployed in front of the Istio gateway proxy.                                                                                                                                                                                                                                                       |

**Authorizer**

| Parameter              | Type    | Description                                                                                                                                 |
|------------------------|---------|---------------------------------------------------------------------------------------------------------------------------------------------|
| **name** (required)    | string  | A unique name identifying the extension authorization provider.                                                                             |
| **service** (required) | string  | Specifies the service that implements the Envoy ext_authz HTTP authorization service. The recommended format is "[<Namespace>/]<Hostname>". |
| **port** (required)    | integer | Specifies the port of the external authorizer on which the authorization request is made.                                                   |
| **headers**            | headers | Specifies headers to be included, added or forwarded during authorization.                                                                  |

**Headers**

| Parameter                | Type       | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|--------------------------|------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **inCheck**              | object     | Defines headers to be included or added in check authorization request.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **inCheck.include**      | \[\]string | List of client request headers that should be included in the authorization request sent to the authorization service.                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **inCheck.add**          | key-value  | Set of additional fixed headers that should be included in the authorization request sent to the authorization service. The Key is the header name and value is the header value. Note that client request of the same key or headers specified in `Include` will be overridden.                                                                                                                                                                                                                                                          |
| **toUpstream**           | object     | Defines headers to be forwarded to the upstream.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **toUpstream.onAllow**   | \[\]string | List of headers from the authorization service that should be added or overridden in the original request and forwarded to the upstream when the authorization check result is allowed (HTTP code 200). If not specified, the original request will not be modified and forwarded to backend as-is. Note, any existing headers will be overridden.                                                                                                                                                                                        | 
| **toDownstream**         | object     | Defines headers to be forwarded to the downstream.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **toDownstream.onAllow** | \[\]string | List of headers from the authorization service that should be added or overridden in the original request and forwarded to the upstream when the authorization check result is allowed (HTTP code 200). If not specified, the original request will not be modified and forwarded to backend as-is. Note, any existing headers will be overridden.                                                                                                                                                                                        | 
| **toDownstream.onDeny**  | \[\]string | List of headers from the authorization service that should be forwarded to downstream when the authorization check result is not allowed (HTTP code other than 200). If not specified, all the authorization response headers, except *Authority (Host)* will be in the response to the downstream. When a header is included in this list, *Path*, *Status*, *Content-Length*, *WWWAuthenticate* and *Location* are automatically added. Note, the body from the authorization service is always included in the response to downstream. | 

### Status

| Parameter                                 | Type       | Description                                                                                                              |
|-------------------------------------------|------------|--------------------------------------------------------------------------------------------------------------------------|
| **state** (required)                      | string     | Signifies the current state of the CR. Its value can be either `Ready`, `Processing`, `Error`, `Warning`, or `Deleting`. |
| **conditions**                            | \[\]object | Represents the current state of the CR's conditions.                                                                     |
| **conditions.&#x200b;lastTransitionTime** | string     | Defines the date of the last condition status change.                                                                    |
| **conditions.&#x200b;message**            | string     | Provides more details about the condition status change.                                                                 |
| **conditions.&#x200b;reason**             | string     | Defines the reason for the condition status change.                                                                      |
| **conditions.&#x200b;status** (required)  | string     | Represents the status of the condition. The value is either `True`, `False`, or `Unknown`.                               |
| **conditions.&#x200b;type**               | string     | Provides a short description of the condition.                                                                           |
