apiVersion: operator.kyma-project.io/v1alpha1
kind: Istio
metadata:
  name: istio-sample
  namespace: kyma-system
  labels:
    app.kubernetes.io/name: istio-sample
spec:
  config:
    authorizers:
    - name: "ext-authz"
      service: "ext-authz.{{.Namespace}}.svc.cluster.local"
      port: "8000"
      headers:
        inCheck:
          include: ["authorization", "cookie"]
          add:
            x-auth-request-redirect: "https://%REQ(:authority)%%REQ(x-envoy-original-path?:path)"
        toUpstream:
          onAllow: ["authorization", "path", "x-auth-request-user", "x-auth-request-email", "x-auth-request-access-token"]
        toDownstream:
          onAllow: ["set-cookie"]
          onDeny: ["content-type", "set-cookie"]